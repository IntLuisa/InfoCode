# FIX-001: Correção na Lógica da Marcação dos dias estudados e da soma dos dias de ofensiva

- Author: Edinaldo Felipe Santiago Filho
- Created: 2023-10-07
- Requested-by: Luiz Carlos

---

## Problema

O aluno ao ficar um dia ou mais sem estudar, é resetada tanto a ofensiva quanto todos os dias marcados no calendário semanal.

## Solução Proposta

O sistema deve resetar os dias de ofensiva, mas deve manter o registro dos dias estudados na semana.

## Análise

- Foi identificado que o método `show` do controller `Auth` da API é chamado quando o aluno faz o login.
- Nele é calculada a diferença entre o dia atual e o primeiro dia estudado(`start_time`). Se o valor for maior que 1, então o atributo `UserConfig.start_time` é atualizado data atual. Resetando assim todos os dias marcados.
- A lógica de marcar os dias estudados e o total de ofensiva não está boa. Pois está apoiada a uma data. Impossibilitando fazer a marcação de dias de estudo alternados.

## Plano de Ação

- Adicionar novo atributo a collection `UserConfig` chamado `study_week_record` para conter os dias da semana estudado.
- Adicionar novo atributo a collection `UserConfig` chamado `consecutive_study_days` para conter os dias estudados em sequência.
- Renomear atributo da collection `UserConfig` chamado `start_time` para `last_date_studed` para conter o último dia estudado.
- Remover os atributos `current_time` da collection `UserConfig`.
- Refazer a lógica de exibir os dias estudados e o total de dias de ofensiva baseado nos novos atributos.
- Refazer a regra de negócio, para atualizar os novos atributos após o aluno terminar o estudo do dia.
- Refazer a validação caso o aluno fique sem estudar um dia ou mais.
- Fazer uma nova validação para que todos os domingos
- Para evitar que alunos antigos percam suas ofensivas com a atualização, desenvolver e rodar um script no banco de dados para adicionar no atributo `consecutive_study_days` os dias estudados dos alunos, levando como base o atributo `start_time`.

---

[Back](../index.md)